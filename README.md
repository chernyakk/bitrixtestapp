# bitrixtestapp
Bitrix24 app for automatical name changing

Приложение создано для автоматической смены названий сделок/лидов (под функционал лидов спроектирована БД, но за ненадобностью в соответствии с ТЗ он не реализован, хотя это дело нескольких минут). Цель приложения: облегчить менеджерам жизнь, автоматически меняя название сделок в соответствии с выбранными полями, чтобы у них не было необходимости заглядывать внутрь сделки. Механизм приложения следующий: администратор устанавливает приложение, выбирает нужные поля (посредством выпадающего списка, в котором вышеупомянутые отмечаются), далее по кнопке "Задать поля" появляется список выбранных полей и рядом с ним нужный селектор (это сделано для того, чтобы поле "Комментарий", который, например, может содержать, пускай, 30 слов, не записывался полностью в название сделки, а только какая-то его часть (задаётся количество слов или символов)), после этого по нажатию кнопки в БД записываются поля (реализовано через AJAX, в обработчик check.php передаётся массив, который всё делает). БД - MySQL, структура следующая: две таблицы, в первой хранятся данные авторизации (портал, токен доступа, обновлемый токен, код клиента), во второй хранятся данные по полям (портал, поля, тип (лид/сделка)). Обновляемый токен, который нужен для автономного доступа к Битрикс24, перезаписывается в случае, если человек зашёл в приложение из интерфейса Битрикс24 или если в Битрикс была добавлена сделка и CRM отправила запрос на изменение. Обработчик события добавления сделки добавляется при установке приложения и отправке полей в БД.
Из имеющихся на данный момент недочётов в работе приложения:
- за достаточно краткий период знакомства с Битрикс24 и предоставляемого REST API я не до конца успел разобраться с событиями установки и удаления приложения, формально они там есть, написан обработчик handler.php, который эти события обрабатывает, но работает он, кажется, некорректно;
- сейчас приложение представляет из себя файл index.php, handler.php и check.php, пару js-скриптов, однако это ужасный с точки зрения чистоты кода вариант, так как всё завязано на одном файле (сейчас index.php определяет, какой REQUEST получен и либо обрабатывает событие добавления, либо переадресовывает через Header на любой сайт (если не было никакого запроса и на приложение зашли просто так), либо отображает окно задания полей/отображает выбранные поля) и нет грамотного распределения функций по файлам. В папке "better version" я начал разбивать приложение на отдельные модули, однако это не окончательный и пока не рабочий вариант;
- приложение не написано в объектно-ориентированном стиле в связи со скудным функционалом и моим не самым лучшим пониманием того, как, но и, что важнее, зачем это нужно сделать;
- я совершенно не фронтендер (на базовом уровне понимаю, как работает jQuery, работал с Bootstrap в другом проекте, но не более) и мне крайне сложно даётся разработка каких-либо интерфейсов, поэтому и интерфейс у него, признаться, ужасный, ограниченный лишь парой стилей на Bootstrap;
- последнее и самое главное: приложение по большей части готово, но оно не в открытом доступе, и в таком виде, естественно, приложение не может увидеть свет. Хранится рабочая версия по адресу bitrixtesting1.000webhost.com (бесплатный небезопасный крайне отвратительно работающий хостинг, предоставляющий, однако, онлайн-редактор кода, что и послужило причиной его выбора).
